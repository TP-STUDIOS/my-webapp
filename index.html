<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Web App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h1>Добро пожаловать в Web App</h1>
    <p id="user-info">Загрузка информации...</p>

    <script>
        window.onload = function() {
            console.log("Telegram.WebApp:", Telegram.WebApp); // Отладка объекта
            const initData = Telegram.WebApp.initData;
            console.log("initData:", initData); // Отладка данных
            if (!initData) {
                document.getElementById('user-info').innerText = 'Ошибка: initData не получено';
                return;
            }

            fetch('https://f843-199-247-16-88.ngrok-free.app/verify', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ initData: initData })
            })
            .then(response => {
                console.log("Response status:", response.status); // Отладка статуса
                return response.json();
            })
            .then(data => {
                console.log("Response data:", data); // Отладка ответа
                if (data.error) {
                    document.getElementById('user-info').innerText = `Ошибка: ${data.error}`;
                } else {
                    document.getElementById('user-info').innerText = 
                        `Username: ${data.username}, First Name: ${data.first_name}`;
                }
            })
            .catch(error => {
                console.error("Fetch error:", error); // Отладка ошибки
                document.getElementById('user-info').innerText = `Ошибка подключения: ${error}`;
            });
        };
    </script>
</body>
</html>
